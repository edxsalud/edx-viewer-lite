<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EDX DICOM Viewer</title>
    <link rel="stylesheet" href="app/css/styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

    <!-- Cornerstone Libraries from CDN -->
    <script src="https://unpkg.com/cornerstone-core@2.6.1/dist/cornerstone.min.js"></script>
    <script src="https://unpkg.com/cornerstone-math@0.1.10/dist/cornerstoneMath.min.js"></script>
    <script src="https://unpkg.com/cornerstone-tools@6.0.10/dist/cornerstoneTools.min.js"></script>
    <script src="https://unpkg.com/dicom-parser@1.8.21/dist/dicomParser.min.js"></script>
    <script
        src="https://unpkg.com/cornerstone-wado-image-loader@4.13.2/dist/cornerstoneWADOImageLoader.bundle.min.js"></script>
</head>

<body>
    <div class="app-container">
        <!-- Left Panel: Studies List -->
        <aside class="sidebar">
            <div class="logo-container">
                <img src="app/images/logo-edx-white.png" alt="EDX Logo" class="app-logo">
                <div class="app-branding">
                    <span class="app-version">Viewer Lite v1.0.0</span>
                </div>
            </div>
            <div class="sidebar-header">
                <h1><i class="fas fa-notes-medical"></i> Estudios</h1>
            </div>

            <!-- File Upload Controls -->
            <div class="upload-controls">
                <button id="btn-load-folder" class="upload-btn">
                    <i class="fas fa-folder-open"></i> Cargar Carpeta DICOM
                </button>
                <input type="file" id="folder-input" webkitdirectory directory multiple style="display: none;">
            </div>

            <div id="studies-list" class="studies-list">
                <div class="no-studies-message">
                    <i class="fas fa-cloud-upload-alt"></i>
                    <p>Carga archivos DICOM para comenzar</p>
                </div>
            </div>
            <div class="disclaimer">
                <i class="fas fa-exclamation-triangle"></i>
                Solo para uso académico e investigación. No recomendado para diagnóstico médico.
            </div>
            <div class="sidebar-footer">
                <button id="btn-about" class="about-btn">
                    <i class="fas fa-info-circle"></i> Acerca de
                </button>
            </div>
        </aside>

        <!-- About Modal -->
        <div id="about-modal" class="modal-overlay hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <span>Sobre EDX Viewer Lite</span>
                    <button class="modal-close" onclick="viewer.closeAboutModal()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="about-logo">
                        <img src="app/images/logo-edx-white.png" alt="EDX Logo">
                    </div>
                    <h2 class="about-title">EDX Viewer Lite</h2>
                    <div class="about-version">1.0.0</div>
                    <div class="about-info">
                        <div class="about-row">
                            <span class="about-label">Navegador & SO</span>
                            <span id="browser-info" class="about-value">-</span>
                        </div>
                    </div>
                    <a href="https://github.com/edxsalud/edx-viewer-lite" target="_blank" class="about-link">
                        <i class="fab fa-github"></i> github.com/edxsalud/edx-viewer-lite
                    </a>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Toolbar -->
            <div class="toolbar">
                <div class="tool-group">
                    <button id="tool-pan" class="tool-btn" title="Mover (Pan)">
                        <i class="fas fa-arrows-alt"></i> Mover
                    </button>
                    <button id="tool-zoom" class="tool-btn" title="Zoom">
                        <i class="fas fa-search-plus"></i> Zoom
                    </button>
                    <button id="tool-wwwc" class="tool-btn active" title="Brillo/Contraste">
                        <i class="fas fa-adjust"></i> W/L
                    </button>
                    <button id="tool-length" class="tool-btn" title="Medir distancia">
                        <i class="fas fa-ruler"></i> Medir
                    </button>
                    <button id="tool-stackscroll" class="tool-btn" title="Scroll de Imágenes" disabled>
                        <i class="fas fa-layer-group"></i> Scroll
                    </button>
                    <button id="tool-reset" class="tool-btn" title="Resetear vista">
                        <i class="fas fa-undo"></i> Reset
                    </button>
                    <button id="tool-download" class="tool-btn" title="Descargar Imagen">
                        <i class="fas fa-camera"></i> Guardar
                    </button>
                </div>
                <div class="image-nav">
                    <button id="prev-image" class="nav-btn" disabled><i class="fas fa-chevron-left"></i>
                        Anterior</button>
                    <span id="image-counter">0 / 0</span>
                    <button id="next-image" class="nav-btn" disabled>Siguiente <i
                            class="fas fa-chevron-right"></i></button>
                </div>
            </div>

            <!-- Viewer with Instructions -->
            <div class="viewer-container">
                <div id="dicom-viewport" class="viewport">
                    <div id="instructions-zone" class="instructions-zone">
                        <h2><i class="fas fa-info-circle"></i> Cómo usar el visor</h2>
                        <div class="instruction-steps">
                            <div class="step">
                                <span class="step-number">1</span>
                                <p>Haz clic en <strong>"Cargar Carpeta DICOM"</strong> en el panel izquierdo</p>
                            </div>
                            <div class="step">
                                <span class="step-number">2</span>
                                <p>Selecciona la carpeta que contiene tus archivos DICOM</p>
                            </div>
                            <div class="step">
                                <span class="step-number">3</span>
                                <p>En el panel <strong>"Estudios"</strong> aparecerán los estudios encontrados</p>
                            </div>
                            <div class="step">
                                <span class="step-number">4</span>
                                <p>Haz clic en una serie para visualizar las imágenes</p>
                            </div>
                        </div>
                        <div class="tools-hint">
                            <p><i class="fas fa-mouse"></i> Usa las herramientas <strong>Mover</strong>,
                                <strong>Zoom</strong> y <strong>W/L</strong> arrastrando sobre la imagen
                            </p>
                            <p><i class="fas fa-scroll"></i> Navega entre imágenes con la rueda del ratón</p>
                        </div>
                    </div>
                </div>
                <!-- Image Stack Scrollbar (Right side) -->
                <div id="image-scrollbar" class="image-scrollbar hidden">
                    <div class="scrollbar-track">
                        <div id="scrollbar-thumb" class="scrollbar-thumb"></div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Right Panel: Patient Info -->
        <aside class="info-panel">
            <div class="panel-header">
                <h2><i class="fas fa-user"></i> Paciente</h2>
            </div>
            <div id="patient-info" class="patient-info">
                <div class="info-placeholder">
                    <p>Sin datos</p>
                </div>
            </div>

            <div class="panel-header">
                <h2><i class="fas fa-clipboard-list"></i> Estudio</h2>
            </div>
            <div id="study-info" class="study-info">
                <div class="info-placeholder">
                    <p>Sin datos</p>
                </div>
            </div>

            <div class="panel-header">
                <h2><i class="fas fa-image"></i> Imagen</h2>
            </div>
            <div id="image-info" class="image-info">
                <div class="info-placeholder">
                    <p>Sin datos</p>
                </div>
            </div>
        </aside>
    </div>

    <!-- Download Modal -->
    <div id="download-modal" class="modal-overlay hidden">
        <div class="modal-content download-modal">
            <div class="modal-header">
                <span>Descargar imagen</span>
                <button class="modal-close" onclick="viewer.closeDownloadModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body download-body">
                <div class="download-preview">
                    <div class="preview-container">
                        <div id="preview-element" style="width: 100%; height: 100%;"></div>
                        <div id="preview-warning" class="preview-warning-overlay hidden">No para uso diagnóstico</div>
                    </div>
                </div>
                <div class="download-controls">
                    <div class="control-group">
                        <label>Nombre del archivo</label>
                        <div class="input-group">
                            <input type="text" id="download-filename" value="Image">
                            <select id="download-format">
                                <option value="jpg">JPG</option>
                                <option value="png">PNG</option>
                            </select>
                        </div>
                    </div>

                    <div class="control-group">
                        <label>Tamaño <span class="unit">px</span></label>
                        <div class="size-inputs">
                            <div class="input-wrapper">
                                <span class="prefix">An</span>
                                <input type="number" id="download-width">
                            </div>
                            <div class="input-wrapper">
                                <span class="prefix">Al</span>
                                <input type="number" id="download-height">
                            </div>
                        </div>
                    </div>

                    <div class="toggles">
                        <label class="toggle-row">
                            <input type="checkbox" id="download-annotations" checked
                                onchange="viewer.updateDownloadPreview()">
                            <span class="toggle-slider"></span>
                            <span class="toggle-label">Incluir anotaciones</span>
                        </label>

                        <label class="toggle-row">
                            <input type="checkbox" id="download-warning" checked
                                onchange="viewer.updateDownloadPreview()">
                            <span class="toggle-slider"></span>
                            <span class="toggle-label">Incluir mensaje de advertencia</span>
                        </label>
                    </div>

                    <div class="download-actions">
                        <button class="btn-cancel" onclick="viewer.closeDownloadModal()">Cancelar</button>
                        <button class="btn-save" onclick="viewer.saveImage()">Guardar</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="app/js/app.js"></script>
</body>

</html>